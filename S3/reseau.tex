\documentclass[10pt,a4paper,french]{article}
\usepackage{babel}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{../latex/clovisai}

\begin{document}

\title{Réseau}
\author{Ivan Canet}
\maketitle

\begin{abstract}
Ceci est l'introduction du document.
\end{abstract}
\tableofcontents

\section{Adresse IP}

Une adresse IPv4 est constituée de 32 bits, elle est utilisée pour communiquer entre machines sur le réseau.

Dans un réseau local, on ``bloque'' le début de l'adresse et on utilise que la fin, par exemple l'adresse de réseau `221.164.0.0/24' bloque les 24 premiers bits, ce qui veut dire que les adresses de ce réseau vont de `221.164.0.1' à `221.164.0.254'.

Dans un réseau, l'adresse finissant par un 0 est l'adresse du réseau (l'adresse de la box/routeur) et l'adresse finissant par 255 est l'adresse de broadcast, qui permet d'envoyer un paquet à tout le monde.

Le réseau `127.0.0.0/8' est un faux réseau qui revient sur soi-même, il est pratique pour tester les applications en réseau, etc. Toutes les adresses commençant par 127 ne partent donc pas sur le réseau, souvent on utilise `127.0.0.1'.

Chaque machine peut se connecter à plusieurs `interfaces' : elles correspondent aux différentes prises sur la carte réseau. Par exemple, la première prise ethernet est nommée `eth0', puis `eth1', etc.

\section{Commandes utiles}

On utilise {\tt dev} pour ``device''.

\paragraph{Afficher adresses IP et interfaces}

\begin{minted}{bash}
ip a
ifconfig
\end{minted}

\paragraph{Afficher les interfaces activées}

\begin{minted}{bash}
ip link ls up
\end{minted}

\paragraph{Assigner une adresse IP et un masque à une interface}

\begin{minted}{bash}
ip a add 192.168.74.101/24 dev eth0
ifconfig eth0 192.168.74.101 netmask 255.255.255.0
\end{minted}

\paragraph{Activer le mode routeur}

\begin{minted}{bash}
sysctl -w net.ipv4.ip\_forward=1
\end{minted}

\paragraph{Voir la table de routage}

\begin{minted}{bash}
ip r
\end{minted}

\paragraph{Ajouter une route par défaut}

\begin{minted}{bash}
ip r add default via 192.168.74.254
route add -net default gw 192.168.74.254
\end{minted}

\paragraph{Ajouter une route}

\begin{minted}{bash}
ip r add 22.33.44.0/24 via 11.22.33.55
route add -net 22.33.44.0 netmask 255.255.255.0 gw 11.22.33.55
\end{minted}

\paragraph{Activer/Désactiver une interface}

\begin{minted}{bash}
ip link set dev eth0 up|down
ifup|ifdown eth0
\end{minted}

\section{Configurer de manière pérenne}

Il faut modifier le fichier {\tt etc/network/interfaces}.

\subsection{Pour un client}

\begin{minted}{bash}
auto eth0
iface eth0 inet static
	address 10.1.1.22                    # IP de la machine
	netmask 255.255.255.0                # Masque de sous-réseau
	gateway 10.1.1.254                   # Route par défaut
\end{minted}

\subsection{Pour un routeur}

\begin{minted}{bash}
auto eth0
iface eth0 inet static
	address 10.1.1.254                   # IP de la machine
	netmask 255.255.255.0                # Masque de sous-réseau
	up sysctl -w net.ipv4.ip_forward=1   # Activer le port forwarding
\end{minted}

On utilise {\tt up} pour lancer une commande au démarrage de l'interface (ici, l'activation du port forwarding, mais on peut mettre n'importe quelle commande).

\end{document}
